- name: /etc/hosts up to date
  copy:
    # this file will be generated by ./setup.sh
    src: "{{ playbook_dir }}/etc_hosts"
    dest: /etc/hosts

- name: ping installed
  apt:
    name: iputils-ping
    state: present
  when: ansible_facts['os_family']|lower == 'debian'

- name: ping all hosts
  shell: "ping -q -c 1 {{ item }} > /dev/null"
  with_items: "{{ groups['all'] }}"
  register: ping_res
  failed_when: "ping_res.rc != 0"
  changed_when: false
  # ignore_errors: true

- block:
  # Check DNS
  - name: ping google by name
    shell: "ping -q -c 1 google.com > /dev/null"
    register: ping_res
    failed_when: "ping_res.rc != 0"
    changed_when: false

  rescue:
    # Check internet
    - name: ping google by ip
      shell: "ping -q -c 1 8.8.8.8 > /dev/null"
      register: ping_res
      failed_when: "ping_res.rc != 0"
      changed_when: false
