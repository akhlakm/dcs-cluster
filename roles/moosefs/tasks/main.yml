- block:
  - import_tasks: check-installation.yml

- name: mfsmaster not localhost
  ansible.builtin.lineinfile:
    path: /etc/hosts
    line: "127.0.0.1     mfsmaster"
    state: absent
  when: mfsmain != inventory_hostname

- block:
    - include_tasks: check-mfsmain.yml
  when: mfsmain == inventory_hostname

- block:

    - name: chunkserver dockerfiles
      copy:
        src: ChunkServer
        dest: /tmp/
        mode: 0744

    - name: container /etc/hosts
      copy:
        # this file will be generated by ./setup.sh
        src: "{{ playbook_dir }}/etc_hosts"
        dest: /tmp/ChunkServer/etc_hosts

    - name: chunkserver script
      copy:
        src: startchunk.sh
        dest: /tmp/startchunk.sh
        mode: 0744

    # Run a chunkserver for each mount points
    - name: Check chunkserver
      include_tasks: check-mfschunk.yml
      loop: "{{ mfschunkmounts | list }}"

  when: mfschunk == true


- block:

    # Run a meta logger in each chunk host
    - name: Check MetaLogger
      include_tasks: loop-mfsmeta.yml
      when: mfsmain != inventory_hostname

  when: mfschunk == true
