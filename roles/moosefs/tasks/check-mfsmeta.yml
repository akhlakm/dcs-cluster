- block:
    - name: metalogger running 
      shell: "docker inspect mfsMeta"
      register: cmd_result
      failed_when: "cmd_result.rc != 0"
      changed_when: false

  rescue:

    - name: chunkserver dockerfiles
      copy:
        src: MetaLogger
        dest: /tmp/
        mode: 0744

    - name: container /etc/hosts
      copy:
        # this file will be generated by ./setup.sh
        src: "{{ playbook_dir }}/etc_hosts"
        dest: /tmp/MetaLogger/etc_hosts

    - name: chunkserver config
      template:
        src: mfsmetalogger.cfg
        dest: /tmp/MetaLogger/mfsmetalogger.cfg
        owner: root
        mode: 0744

    - name: metalogger script
      copy:
        src: startmeta.sh
        dest: /tmp/startmeta.sh
        mode: 0744

    - name: docker build and run metalogger
      shell:
        cmd: "/tmp/startmeta.sh {{ inventory_hostname }}"
        chdir: /tmp
      register: cmd_result
      failed_when: "cmd_result.rc != 0"
